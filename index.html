
<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8" />
<meta name="viewport" content="width=device-width, initial-scale=1.0" />
<title>Exam‑Safe Python IDE</title>

<style>
  :root { --bg:#1e1e1e; --panel:#2d2d2d; --accent:#007acc; --txt:#eaeaea; --out:#00ff99; }
  html,body {
    height:100%; margin:0;
    background:var(--bg); color:var(--txt);
    font UI,Roboto,Arial,sans-serif;
    overflow:hidden;
  }

  #topbar {
    display:flex; gap:12px; align-items:center;
    justify-content:space-between;
    background:var(--panel);
    padding:10px 12px;
  }
  .left { display:flex; gap:10px; align-items:center; }
  label { font-size:14px; opacity:.9; }

  input[type=text] {
    background:#111; color:var(--txt);
    border:1px solid #444; border-radius:4px;
    padding:6px 8px;
  }

  button {
    background:var(--accent);
   px 14px;
    border-radius:4px;
    font-size:15px; cursor:pointer;
  }

  #container {
    display:grid;
    grid-template-columns: 1fr 1fr;
    grid-template-rows: 1fr 1fr;
    height: calc(100vh - 56px);
  }

  #editor {
    grid-column:1/2; grid-row:1/3;
    width:100%; height:100%; box-sizing:border-box;
    padding:12px; background:#121212; color:#ddd;
    font-family:monospace; font-size:16px;
    border:none; outline:none; resize:none;
  }

  #output {
    grid-column:2/3; grid-row:1/2;
    width:100%; height:100%; box-sizing:border-box;
    padding:12px; background:#0c0c0c; color:var(--out);
    font-family:monospace; font-size:15px;
    white-space:pre-wrap; overflow:auto;
  }

  #questionPane {
    grid-column:2/3; grid-row:2/3;
    background:#0d0d0d; color:white;
    border-top:1px solid #333;
    overflow:hidden;
  }
  #questionPane header {
    display:flex; align-items:center; justify-content:space-between;
    padding:6px 10px; background:#111; font-size:14px;
  }
  #questionPane iframe {
    width:100%; height: calc(100% - 30px);
    border:none;
  }
</style>
</head>

<body oncontextmenu="return false">

<div id="topbar">
  <div class="left">
    <strong>Exam IDE</strong>
    <label>First name:
      <input type="text" id="firstName" autocomplete="off" spellcheck="false">
    </label>
    <label>Last name:
      <input type="text" id="lastName" autocomplete="off" spellcheck="false">
    </label>
  </div>

  <div class="right">
    <span id="status">Offline‑ready:
      <span id="offlineFlag">warming…</span>
    </span>
    <button id="runBtn">Run ▶</button>
    <button id="submitBtn">Submit</button>
  </div>
</div>

<div id="container">
  <textarea id="editor"># Example:
print("Hello world!")</textarea>

  <pre id="output"></pre>

  <section id="questionPane">
    <header>
      <strong>Question (View‑only)</strong>
      <span id="qStatus" style="font-size:12px;opacity:.75"></span>
    </header>
    <iframe id="questionFrame" referrerpolicy="no-referrer"></iframe>
  </section>
</div>

<!-- ✔ Correct Pyodide loader -->
<script src="https://cdn.jsdelivr.net/pyodide/v0.24.1/full/pyodide.js">

<script>
// Debug confirmation
console.log("JS running.");

//
// ✔ Pyodide loader with stdout/stderr capture
//
let pyReady = loadPyodide({
  stdout: (msg) => {
    const out = document.getElementById("output");
    out.textContent += msg + "\n";
  },
  stderr: (msg) => {
    const out = document.getElementById("output");
    out.textContent += "[error] " + msg + "\n";
  }
}).then(py => {
  console.log("Pyodide ready.");
  return py;
});

// =========================
//      CONFIGURATION
// =========================
const SUBMIT_URL   = "PASTE_APPS_SCRIPT_WEB_APP_URL_HERE";
const SUBMIT_TOKEN = "CHANGE_ME_SECRET";

// Question viewer source
const QUESTION_MODE = "drive";   // "drive" or "local"
const QUESTION_DRIVE_URL = "PASTE_DRIVE_PREVIEW_URL_HERE";
const QUESTION_LOCAL_PATH = "./questions/sample_question.pdf";

// Load the question viewer
const qFrame  = document.getElementById("questionFrame");
const qStatus = document.getElementById("qStatus");
const questionURL =
  (QUESTION_MODE === "local") ? QUESTION_LOCAL_PATH : QUESTION_DRIVE_URL;

qFrame.src = questionURL;
qFrame.addEventListener("load", () => qStatus.textContent = "loaded");

//
// ✔ Python execution
//
async function runCode() {
  const out  = document.getElementById("output");
  const code = document.getElementById("editor").value;

  out.textContent = "Running...\n\n";

  try {
    const py = await pyReady;
    const result = await py.runPythonAsync(code);

    if (result !== undefined) {
      out.textContent += result + "\n";
    }
  } catch (err) {
    out.textContent += "[error] " + err + "\n";
  }
}

//
// ✔ Submission handler
//
async function submitCode() {
  const first = document.getElementById("firstName").value.trim();
  const last  = document.getElementById("lastName").value.trim();
  if (!first || !last) {
    alert("Enter first and last name before submitting.");
    return;
  }

  const payload = {
    token: SUBMIT_TOKEN,
    firstName: first,
    lastName: last,
    code: document.getElementById("editor").value,
    userAgent: navigator.userAgent,
    timestamp: new Date().toISOString()
  };

  try {
    const resp = await fetch(SUBMIT_URL, {
      method: "POST",
      headers: { "Content-Type": "application/json" },
      body: JSON.stringify(payload),
      mode: "cors"
    });

    if (!resp.ok) throw new Error("Submit failed: " + resp.status);
    alert("Submission sent.");
  }
  catch (err) {
    alert("Could not submit.\n" + err.message);
  }
}

//
// ✔ Event listeners
//
document.getElementById("runBtn").addEventListener("click", runCode);
document.getElementById("submitBtn").addEventListener("click", submitCode);

</script>

</body>
</html>
